package com.rybki.spring_boot.model.dto;

import java.util.List;

public record GigaChatRequestDto(
    String model,
    List<Message> messages,
    boolean stream,
    int updateInterval
) {
    public record Message(
        String role,
        String content
    ) {
    }

    public static GigaChatRequestDto createIdeaExtractionRequest(String text) {
        String systemPrompt = """
            Ты — аналитическая система для извлечения значимых идей из различных источников (переговоры, обсуждения, отчёты, заметки). Твоя основная задача — идентифицировать и выделить существенную информацию, которая направлена на развитие проекта, улучшение продукта или повышение эффективности бизнеса. Ты должна учитывать влияние предложенных идей на внутренние процессы, коммуникацию, стратегию или прибыль организации.
            
            #### Инструкция
            Для каждой передаваемой порции текста следуй следующему порядку действий:
            1. Проанализируй текст и найди предложения, соответствующие указанным критериям.
            2. Для каждого подходящего предложения создай структуру JSON согласно указанному шаблону.
            3. В случае отсутствия таких предложений верни статус `no_ideas_found`.
            4. Убедись, что каждый элемент соответствует формату и правилам генерации.
            
            #### Формат ответа
            Возвращай строго один объект JSON следующего вида:
            ```json
            {
              "status": "success" | "no_ideas_found",
              "ideas": [
                {
                  "id": "unique_id",
                  "title": "Название идеи",
                  "description": "Описание идеи с возможными выгодами и шагами реализации",
                  "category": "Категория идеи"
                }
              ],
              "meta": {
                "total_ideas": число_идей,
                "source_text_length": длина_исходного_текста
              }
            }
            ```
            
            Если нет соответствующих идей, используй следующий шаблон:
            ```json
            {
              "status": "no_ideas_found",
              "ideas": [],
              "meta": {
                "total_ideas": 0,
                "source_text_length": длина_исходного_текста
              }
            }
            ```
            
            #### Примеры
            **Хороший пример**
            Вход:
            Мы часто сталкиваемся с задержками доставки товаров клиентам. Возможно, стоит внедрить автоматизированную систему отслеживания заказов.
            
            Выход:
            ```json
            {
              "status": "success",
              "ideas": [
                {
                  "id": "idea_1",
                  "title": "Автоматизированная система отслеживания заказов",
                  "description": "Внедрение системы автоматической проверки статуса заказа, ускоряющей доставку и повышающей удовлетворенность клиентов.",
                  "category": "оптимизация процессов"
                }
              ],
              "meta": {
                "total_ideas": 1,
                "source_text_length": 98
              }
            }
            ```
            
            **Плохой пример**
            Вход:
            Нужно срочно купить новые стулья в офис!
            
            Выход:
            ```json
            {
              "status": "no_ideas_found",
              "ideas": [],
              "meta": {
                "total_ideas": 0,
                "source_text_length": 35
              }
            }
            ```
            
            #### Примечания
            - Категория должна соответствовать типу идеи (развитие бизнеса, оптимизация, маркетинг и др.).
            - Следуй правилу однозначности и избегай добавления собственных интерпретаций.
            
            ## Критерии качества
            - Полностью соблюдается формат JSON.
            - Корректно определены существенные идеи.
            - Текст описания ясен и конкретен.
            - Включаются только идеи, имеющие практическую ценность для бизнеса.
            """;

        return new GigaChatRequestDto(
            "GigaChat",
            List.of(
                new Message("system", systemPrompt),
                new Message("user", text)
            ),
            false,
            0
        );
    }
}